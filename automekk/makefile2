# Set MCU and tools
MCU = avr128db48                  # Update with your AVR architecture
CC = avr-gcc                      # Use avr-gcc instead of xc8-cc
OBJCOPY = avr-objcopy             # GNU objcopy for AVR
CFLAGS = -mmcu=$(MCU) -Os -Wall   # Use avr-gcc flags
LDFLAGS = -mmcu=$(MCU)
SRC = main.c
OBJ = $(SRC:.c=.o)
ELF = main.elf
HEX = main.hex

# Rules
all: $(HEX)

$(OBJ): $(SRC)
	$(CC) $(CFLAGS) -c $< -o $@

$(ELF): $(OBJ)
	$(CC) $(OBJ) -o $@ $(LDFLAGS)

$(HEX): $(ELF)
	$(OBJCOPY) -O ihex $< $@

flash: $(HEX)
	avrdude -p $(MCU) -c pkobn_updi -U flash:w:$(HEX):i

clean:
	rm -f $(OBJ) $(ELF) $(HEX)
